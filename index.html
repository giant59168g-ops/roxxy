<script>
        // --- ตัวแปรสำหรับเช็คสถานะ ---
        var player;
        var isPlayerReady = false; // เช็คว่า YouTube พร้อมหรือยัง

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-audio', {
                height: '0',
                width: '0',
                videoId: 'SbdOIdg2McI', // รหัสคลิปเพลง
                playerVars: {
                    'autoplay': 0,
                    'controls': 0,
                    'rel': 0,
                    'showinfo': 0,
                    'loop': 1,
                    'playsinline': 1 // **สำคัญสำหรับ iOS** ให้เล่นในหน้าเว็บไม่เด้ง Fullscreen
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        var isPlaying = false;
        var progressBar = document.getElementById('progress-fill');
        var playBtn = document.getElementById('play-btn');
        var playIcon = playBtn.querySelector('i');
        var timeInfo = document.getElementById('time-info');
        var progressInterval;

        function onPlayerReady(event) {
            isPlayerReady = true; // บอกว่า YouTube โหลดเสร็จแล้ว
            player.setVolume(30); // ตั้งเสียงรอไว้
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                playIcon.classList.remove('fa-play');
                playIcon.classList.add('fa-pause');
                startProgressLoop();
            } else if (event.data == YT.PlayerState.ENDED) {
                player.playVideo(); 
            } else {
                isPlaying = false;
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
                stopProgressLoop();
            }
        }

        playBtn.addEventListener('click', function() {
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        });

        function startProgressLoop() {
            stopProgressLoop();
            progressInterval = setInterval(function() {
                if (!player || !player.getDuration) return;
                var currentTime = player.getCurrentTime();
                var duration = player.getDuration();
                if (duration > 0) {
                    var percent = (currentTime / duration) * 100;
                    progressBar.style.width = percent + '%';
                    timeInfo.innerText = formatTime(currentTime) + ' / ' + formatTime(duration);
                }
            }, 100);
        }

        function stopProgressLoop() {
            clearInterval(progressInterval);
        }

        function formatTime(seconds) {
            var min = Math.floor(seconds / 60);
            var sec = Math.floor(seconds % 60);
            return min + ':' + (sec < 10 ? '0' : '') + sec;
        }

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // --- ส่วนที่แก้ไข: การกดเข้าเว็บ (Click to Enter) ---
        var overlay = document.getElementById('click-overlay');
        
        if (overlay) {
            overlay.addEventListener('click', function() {
                // เช็คว่า Player พร้อมไหม
                if (player && isPlayerReady) {
                    player.unMute();      // **สำคัญ** สั่งเปิดเสียงก่อน
                    player.setVolume(30); // ตั้งระดับเสียง
                    player.playVideo();   // สั่งเล่น
                }

                // ซ่อนหน้าจอ Overlay
                overlay.style.opacity = '0';
                setTimeout(function() {
                    overlay.style.display = 'none';
                }, 500);
            });
        }

        // --- Modal (Roblox) ---
        var robloxBtn = document.querySelector('.badge-icon.roblox');
        var robloxModal = document.getElementById('roblox-modal');
        var closeBtn = document.querySelector('.close-btn');

        if (robloxBtn) {
            robloxBtn.addEventListener('click', function(e) {
                e.preventDefault();
                robloxModal.classList.add('show');
            });
        }
        if (closeBtn) {
            closeBtn.addEventListener('click', function() {
                robloxModal.classList.remove('show');
            });
        }
        window.addEventListener('click', function(e) {
            if (e.target == robloxModal) {
                robloxModal.classList.remove('show');
            }
        });
    </script>
